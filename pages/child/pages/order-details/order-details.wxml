<!--pages/child/pages/order-details/order-details.wxml-->
<!-- 订单详情 -->
<wxs module="filters" src="../../../../utils/number.wxs"></wxs>
<view class='wrap'>
  <view class='order-status'>
    <!-- 判断订单状态 -->
    <!-- 订单已完成 -->
    <view wx:if="{{status =='3' || status == '4'}}" class='order-status-msg'>
      <!-- 订单状态 -->
      <view class='deal-status'>
        <image src='../images/jiaoyichenggong.png' mode='aspectFit'></image>交易成功
      </view>
    </view>
    <!-- 订单待支付 -->
    <view wx:elif="{{status =='0'}}" class='order-status-msg'>
      <!-- 订单状态 -->
      <view class='deal-status'>
        <image src='../images/dengdaifukuan.png' mode='aspectFit'></image>等待买家付款
      </view>
      <view class="flex-view">
        <view>待支付: ￥{{price}}</view>
        <view>剩余:{{clock}}</view>
      </view>
    </view>
    <!-- 订单待发货 -->
    <view wx:elif="{{status =='1'}}" class='order-status-msg'>
      <!-- 订单状态 -->
      <view class='deal-status'>
        <image src='../images/yifukuan.png' mode='aspectFit'></image>买家已付款
      </view>
    </view>
    <!-- 订单退款中 -->
    <view wx:elif="{{status =='6'}}" class='order-status-msg'>
      <!-- 订单状态 -->
      <view class='deal-status'>
        <image src='../images/dengdaifukuan.png' mode='aspectFit'></image>退款中
      </view>
    </view>
    <!-- 订单退款通过 -->
    <view wx:elif="{{status =='7'}}" class='order-status-msg'>
      <!-- 订单状态 -->
      <view class='deal-status'>
        <image src='../images/jiaoyichenggong.png' mode='aspectFit'></image>已退款
      </view>
    </view>
    <!-- 订单待收货 -->
    <view wx:elif="{{status =='2'}}" class='order-status-msg'>
      <!-- 订单状态 -->
      <view class='deal-status'>
        <image src='../images/yifahuo.png' mode='aspectFit'></image>买家已发货
      </view>
      <view class='explain'>还剩15天自动确认收货</view>
    </view>
    <!-- 订单已取消 -->
    <view wx:elif="{{status =='5'}}" class='order-status-msg'>
      <!-- 订单状态 -->
      <view class='deal-status'>
        <image src='../images/quxiaodingdan.png' mode='aspectFit'></image>买家取消订单
      </view>
      <!-- <view class='explain'>退款将在3-5个工作日退回支付账户,有疑问请联系商家</view> -->
    </view>
  </view>
  <!-- 用户地址与物流 -->
  <view class='order-dom'>
    <!-- 判断是否显示物流信息 -->
    <view class='dom-li' wx:if="{{status == '2'}}" bindtap="querylogistics" hidden="{{islog}}">
      <view class='li-left'>
        <image mode='aspectFit' src='../images/logistics_icon.png'></image>
      </view>
      <view class='li-right'>
        <view class='li-rt-title'>{{acceptStation}}</view>
        <view class='li-rt-time'>{{acceptTime}}</view>
        <image src='../images/management_site.png' class='hasmore'></image>
      </view>
    </view>
    <!-- 用户地址 -->
    <view class='dom-li'>
      <view class='li-left'>
        <image mode='aspectFit' src='../images/location_xinxi.png'></image>
      </view>
      <view class='li-right'>
        <view class='li-rt-user'>
          <text>{{orderDetailData.takeDeliveryPerson}}</text>
          <text class='user-phone'>{{orderDetailData.telephone}}</text>
        </view>
        <view class='user-address'>{{orderDetailData.deliveryAddress}}</view>
      </view>
    </view>
  </view>
  <!-- 订单店铺信息 -->
  <view class='order-dom '>
    <view class='shopName'>{{orderDetailData.shopName}}
      <image src='../images/shangjia_zhengjia.png' mode='aspectFit'></image>
    </view>
    <view class='dom-li' wx:for="{{orderDetailList}}" wx:key="{{item.goodsNo}}">
      <view class='li-left goods-img'>
        <image src='{{item.goodsImg}}' mode="aspectFill"></image>
      </view>
      <view class='li-right goods-msg'>
        <view class='li-rt-shop'>{{item.goodsName}}</view>
        <view class='li-rt-size'>
          <text wx:if="{{item.specValue != null}}">{{item.specValue}}</text>
          <text>x{{item.num}}</text>
        </view>
        <view class="top-fahuo" wx:if="{{status!=-2}}">{{item.deliveryTime*24}}小时内发货</view>
        <view class='li-rt-price'>￥{{item.price}}</view>
      </view>
    </view>
    <view class='dom-li-shop'>
      <view>商品总价</view>
      <view>￥{{orderDetailData.goodsAllPrice}}</view>
    </view>
    <view class='dom-li-shop'>
      <view>运费(快递)</view>
      <view>￥{{orderDetailData.fare == null ?  '0' :orderDetailData.fare}}</view>
    </view>
    <view class='dom-li-shop'>
      <view>优惠减免</view>
      <view>-￥{{orderDetailData.voucherPrice}}</view>
    </view>
    <view class='shop-goods-price'>实付款
      <text>￥{{orderDetailData.price}}</text>
    </view>
  </view>
  <!-- 订单来源 -->
  <view class="order-dom" wx:if="{{orderType != 0}}">
    <view class="order-detail-title">订单来源:
      <text>{{orderTypeName}}</text>
    </view>
  </view>
  <!-- 订单信息 -->
  <view class='order-dom'>
    <view class='order-border'></view>
    <view class='order-detail-title'>订单信息</view>
    <view class='clear'></view>
    <view class="order-detail-li" wx:if="{{orderDetailData.remark != ''}}">订单备注:{{orderDetailData.remark||""}}</view>
    <view class='order-detail-li'>订单编号:{{orderDetailData.orderNo}}</view>
    <view class='order-detail-li' wx:if="{{status != '0' && orederType == 0 }}">支付方式:在线支付-{{orderDetailData.payTypeText}}支付</view>
    <view class='order-detail-li' wx:if="{{status != '0' && orederType == 0 }}">支付交易号:{{orderDetailData.tranNo}}</view>
    <view class='order-detail-li'>下单时间:{{orderDetailData.orderTime}}</view>
    <view class='order-detail-li' wx:if="{{status != '0' && orederType == 0 }}">付款时间:{{orderDetailData.tranDate}}</view>
    <view class='order-detail-li' wx:if="{{status != '0' && status != '1' && status != '5'&&orderDetailData.deliveryDate!=null}}">发货时间:{{orderDetailData.deliveryDate}}</view>
    <!-- <view class='order-detail-li' wx:if="{{status == '3' || status == '4'}}">完成时间:{{orderDetailData}}</view> -->
    <view  class='order-detail-li'  wx:if="{{status == '2'&&deliveryNo!=null}}">配送方式:{{companyName}} {{deliveryNo}}
      <text class="fuzhi" bindtap="fuzhidanhao">复制</text>
    </view>
  </view>
</view>
<!---推荐 猜你喜欢-->
<view class='recommend'>
  <view class='recommend-title'>
    <image class='icon-border icon-left' src='../images/shoppingcar_icon3.png'></image>
    <view class='icon-img'>
      <image src='../images/like_help.png'></image>
    </view>
    <view>猜你喜欢</view>
    <image class='icon-border' src='../images/shoppingcar_icon3.png'></image>
  </view>
  <view class='rec-ul'>
    <block wx:for="{{likedata}}" wx:key='index'>
      <view class='rec-li' bindtap='toGoodsDetails' data-goodsNo='{{item.goodsNo}}'>
        <view class='help-li-img'>
          <image src='{{item.imgPath}}'></image>
        </view>
        <view class='rec-li-tit'>{{item.goodsName}}</view>
        <view class='rec-money'>¥{{vipGrade == '1'? item.price : filters.toFix(item.price - item.profit *vipRate)}}</view>
        <view class='rec-nomoney' wx:if="{{vipRate&&vipGrade!=1}}">￥{{item.price}}</view>
      </view>
    </block>
  </view>
</view>
<!-- 状态操作 判断状态显示不同操作 --> 
<view class='handle-bootom' wx:if="{{status != 5 }}">
  <view class='btn-gray' wx:if="{{status == 3||status == 7}}" bindtap="delOrder">删除订单</view>
  <view class='btn-gray' wx:if="{{status == 0 && orderType =='0'}}" bindtap="cancelOrder">取消订单</view>
  <!-- <view class='btn-gray' wx:if="{{status != 4 || status != 5}}">联系商家</view> -->
  <view class='btn-gray' wx:if="{{status == 1}}" bindtap="handleRemind">提醒发货</view>
  <view class='btn-gray' wx:if="{{status == 1&&orderType==0&&allowRefund}}" bindtap="gorefund">申请退款</view>
  <view class='btn-gray' wx:if="{{shouhou}}" bindtap="gorefunds">申请售后</view>
                                                                    <!-- 去退款详情的 -->
  <view class='btn-gray' wx:if="{{status == 6}}" bindtap="gorefundss">退款进度</view>
                                                                    <!-- 去退款进度的  -->
  <view class='btn-gray' wx:if="{{status == 7}}" bindtap="gorefundsss">退款进度</view>
  <!-- <view class='btn-gray' wx:if="{{status == 2}}">延长收货</view> -->
  <view class='btn-gray btn-color' wx:if="{{status == 3}}" bindtap="evaluate">立即评价</view>
  <view class='btn-gray btn-color' wx:if="{{status == 0}}" bindtap="handlePay">付款</view>
  <view class='btn-gray btn-color' wx:if="{{status == 2}}" bindtap="affirm">确认收货</view>
  <view class='btn-gray' wx:if="{{status === 2 || status === 3 }}" bindtap="checklogistics">查看物流</view>
  <button open-type="share" class='btn-gray btn-color' wx:if="{{(status == 2|| status == 1 )&& orderType == '3' && orderDetailList.length == 1}}">立即代言</button>
</view>
<!-- 判断如果订单有多个商品 代言购商品展示和选择 -->
<view class="shareSP {{ isShareTrue ? 'isShareShow ' :'isShareHide '}}">
  <view class='shareContent '>
    <scroll-view scroll-y style='max-height:280px ' bindscrolltoupper="upper" bindscrolltolower="lower" bindscroll="scroll" scroll-into-view="{{toView}}" scroll-top="{{scrollTop}}">
      <button open-type='share'>
        <view class='shareText ' wx:for="{{orderDetailList}}" wx:key="{{item.goodsNo}}">
          <view class='shareleft '>
            <image mode='scaleToFill' src='{{item.goodsImg}}'></image>
          </view>
          <view class='shareright '>
            {{item.goodsName}}
          </view>
        </view>
      </button>
    </scroll-view>
    <image src='../images/remove.png ' class='shareHide ' bindtap='hideShare'></image>
  </view>
</view>
<logins id="logins" bind:callSomeFun="callSomeFun"></logins>
